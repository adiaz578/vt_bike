/*
 * Test vectors for ECDSA with curve P224 and SHA3-224.
 *
 * The only test vectors we could find for SHA3 were from the ACVP program. The
 * KATs for checking signatures didn't include the nonce `k`, which is necessary
 * to randomize the signature, so this does not include any KATs for signing;
 * only for verification.
 *
 * [ACVP]: NIST. usnistgov. GitHub repo "ACVP-Server".
 *     @see https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ECDSA-SigGen-FIPS186-5
 *
 * @copyright Galois, Inc.
 * @author Marcella Hastings <marcella@galois.com>
 */
module Primitive::Asymmetric::Signature::ECDSA::Tests::ECDSA_P224_SHA3_224 where
import Primitive::Asymmetric::Signature::ECDSA::Instantiations::ECDSA_P224_SHA3_224 as ECDSA
import Common::utils(BVtoZ)
import Common::EC::PrimeField::Instantiations::P224 as EC

/**
 * This tests the signature verification vectors for curve "P-224" and hashAlg
 * "SHA3-224" from [ACVP] "ECDSA-SigGen-FIPS186-5".
 * ```repl
 * :prove testVerification
 * ```
 */
property testVerification = publicKeyWorks && sigVerWorks where
    // Check that the provided `d` computes the expected public key.
    publicKeyWorks = EC::affineEq (ECDSA::publicKey d) (EC::Affine qx qy)

    d = BVtoZ 0x2F9D814730AF0085C942FE8B679B023C0DB5AFAC27613D7CEC883405
    qx = BVtoZ 0x47E1E01BBE0407877C18D7B94ACFC690BDCF0AF6D6A9EC91CA59F772
    qy = BVtoZ 0x5DA449E730C30BE4D65A605F2BA6FCBF390310E02246A9135ECE16AA

    // Check that the given message-signature pairs all verify.
    checkSigVer msg r s = ECDSA::verify msg (r, s) (ECDSA::publicKey d)
    sigVerWorks = and [checkSigVer msg (BVtoZ r) (BVtoZ s) | (msg, r, s) <- [
        (msg61, r61, s61),
        (msg62, r62, s62),
        (msg63, r63, s63),
        (msg64, r64, s64),
        (msg65, r65, s65),
        (msg66, r66, s66),
        (msg67, r67, s67),
        (msg68, r68, s68),
        (msg69, r69, s69),
        (msg70, r70, s70)
    ]]

    // See "internalProjection.json", section "tgId = 7".
    msg61 = 0x030D2C1918E8473FFCEB9A78A4331387757C8808B7D57F06A4A268DFE6178CF7236BEBD8C4F49BD73A65796973B64FBED7E38F56B95639EFE6F00DB4BF82A476540E2EF3F2EB6B05D3425EF1C465F6B25628618B8EE005525EDDC32FF96F1999563ECE6A68A6E6396E1D37BEA898CDA91F0723D91BFBB423789799D824D9220A
    r61 = 0x3612063972B03272569A0A4860948A06544E1D21F19995880ACC0AFA
    s61 = 0x0F6E9C94A55155AAAFE842637A84AC0C57F6CE67E721FC4CBA3FD7FD

    msg62 = 0x56E761977EF6A0C1E08EA96FF909089AA451F0B4B7EEB6B8F978E4D32FACDB3158D4C96AD7FDE38B387994C1913E5B64FF8C02465137AD1F5239956181D93B744F3BAE546D0827A69742EB650E09F18ED966AC6A202A6C06293772FEA47BCD23DFA2CA82CC35CAABF62371BE3DD756C43739DC4FFC1A171ABD7A8937B31ECA08
    r62 = 0x2ECB9ADE16CC813B56F72538C9223684761316142B6348180765DAF3
    s62 = 0xC22705FC831663A661C2C780986F43AFAAA3B0DE46066372881D4BCA

    msg63 = 0x0AD042754785A6F67D037F5CA4497F8E71653DDB721AA401AD46FE04994A0537EFFE3356FA5CF8A91C43B1F75309332D3D97BEE61C8B5E3E273CD2402EC2392EFAD266D876BC262F4C5A67D058CC3E7F872CC7D379000A56D6A913208C4403831409C39189BA59056A38E626E235E73B5D5E8531454E38BE64F093D0C2916732
    r63 = 0x454589AD9EC014E14A6F1947D64578B31F81E6E2AA8C69584CD4EE9D
    s63 = 0x89D832DEDC403EE2D9A899E58A556CAFAC2B236C48210927657609C6


    msg64 = 0x07C9B2EB7CA9B7717521520D1E5CE996A415FFDE9E858288167C54B22FBF19CFC982AF2E2DD5F12C8B135AEA788BAFF48F08DE83730CC2B6F7E0C06ED64385D00CCB99CD51789F839872EA603C7A69D7EB2AF5B490259A625000A7CC588A9F75749664E1629A1F85BD6EA90D6F12B69FAD19F875B8FA6671ACFB6870FE5DF141
    r64 = 0x546CE2F2EE8EC5CFF9A3065EF5006F37521FAD405A8069863BD4BDEB
    s64 = 0x58AB96923D3FEE1F56D399C33DDB4324B43BC99EAC54D5464C5F5A05

    msg65 = 0x4AEB2C6FDA5C7DA730348816DDB0E3910B2DD91BC8E5D9C34DBF6A8F1B5C8E251F94CC6A6642E1AD3A1B086B075160F9B7BB90BB78CF09165592B1BC0AB7C239A090683EAA9B4D9CE951EBD2FC2E56FF7B7447DE962EB687D27705B3DECBFF25ED059A5E51DC6EFF9A26EA2E57DB8E5B4690870ADDB03E3AEEB91A189BE7C3D3
    r65 = 0x9BCCD499ED71E53C4A5AA52C357BD10B881BE82C35E62B37F99F950F
    s65 = 0x144722D59C95D2C6A0A161EE58245A04A06F226EEC91A26F972B7FF1

    msg66 = 0x19773A3F4941F74B9AB5C304B85A9C11371D63B41DDEE0B604358CD2E0A325F627D9A0C7762D5E25E3EEB8F2D276C3796C0C181E07C6D3BA3EB16CA866DA3952A7967B7CD3081D4F3B6B7BF0981F6871DEF2AC1AF6CD8DA35573CF947C99905EDE50123AE7A16C18270EEB956A282D0E46E942F73818A3BAD1631D4021455E27
    r66 = 0xED76263F419C4595B9F688C0DD45A2F58178D37F4BFA03BF485D85AA
    s66 = 0xA7A96CB96456F5A91DB03B430DF578AF977F6ABD89E4126E1CCC08B7

    msg67 = 0xBB62A3CDC9A276156EA316F9B2224710AB35A23BEFE5E2C0C1835B4BBD4E1A91FF73D5442482C8CE19DED1C88999187DD369FC9F56BF4791A7C850927090F43F6BA092CAA01A7AA8D4F9FB367689881115CBDBB18E8632923E755F9F2A9DC71514485111AA2D48AE1A8A258951850706677A2F37A50888BDB23DF8E8C99532F9
    r67 = 0xE92DC7F00699078E5DF2A77AD630E5AA49E54DC7723826E2BBF174D4
    s67 = 0xBA09D6DFA3287C280CAE0D6482A36C5BBDBE4F60E80E9DD86A8EB685

    msg68 = 0x698E81344C797C92BBAF6D3C6DDF344D379B2036DFD7561A341A1B5E0450FC24A3198FA256FBBB394F96E3D34DDCF148E10541AE3F048BF931D72F07B2CC289E83BB195E271552794A603B6AD087F26422CE2B2CEE80E0BD78B7B8A874059A8A01B35B3F4113160C31302F20C103B0E980A40D4D562952DEFB5A713E2183A979
    r68 = 0x958CADFBF3BD03AE51701EB69365CA64D2D6AD620A3BDE4BD9FCE0EB
    s68 = 0x80C3655C742F372C5162979839BF35F660ABDC52C6415E1C320FF204

    msg69 = 0x85FD8580DE5605F8569A41D11A53115ABBB0D228CA9E5C992725F8392495765FEE802665A58826897B8511E4554B07FE0E48930E9B7349AC622B0805E0807E687E971C215120A34EBE6E9C134BBFC4302AD8BAA2FDF4F70BA1788549D7E5F717995CA31A7C32D6C9EB9103927FEB24E874E0EAD79818C422B1985428E98EE0C1
    r69 = 0xCC4E52755299819099619FA4EC7BDA3D9A05EA001BB52E04F3835912
    s69 = 0x2B809FB7A3260B6756AFD0F23A3626BD20D9D96A194EA70A99F61BE2

    msg70 = 0xFEFE7D84406988E58A370770897CA87ECDDB1593BCE17358A8837C86D3BCA694F9D621DB81794A64170A5AAE23E6FCAFF487672ED5A2851FD9FFFE8ACDA0EFE5E62A57862B9D05350AEB3642014D57A60E4A26C3A18DBF515C4D7886AE544F4E4C5CFB7A8D0BF91A4A08BB95F4E26D5286ACDF1DEE3B41E1A5E49125B84F3EC5
    r70 = 0xD36FB3D8C67486A2091C8AC6CF1BC28A29F8CCDABE99B5A1F074BEBF
    s70 = 0x385F7A0EA55C01714D2A5BB2F5B07334AE24B2B1E91F0FF91C657639

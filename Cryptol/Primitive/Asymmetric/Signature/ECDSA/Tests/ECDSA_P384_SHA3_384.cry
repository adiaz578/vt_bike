/*
 * Test vectors for ECDSA with curve P-384 and SHA3-384.
 *
 * The only test vectors we could find for SHA3 were from the ACVP program. The
 * KATs for checking signatures didn't include the nonce `k`, which is necessary
 * to randomize the signature, so this does not include any KATs for signing;
 * only for verification.
 *
 * [ACVP]: NIST. usnistgov. GitHub repo ACVP-Server.
 *     @see https://github.com/usnistgov/ACVP-Server/blob/master/gen-val/json-files/ECDSA-SigGen-FIPS186-5
 *
 * @copyright Galois, Inc.
 * @author Marcella Hastings <marcella@galois.com>
 */
module Primitive::Asymmetric::Signature::ECDSA::Tests::ECDSA_P384_SHA3_384 where
import Primitive::Asymmetric::Signature::ECDSA::Instantiations::ECDSA_P384_SHA3_384 as ECDSA
import Common::utils(BVtoZ)
import Common::EC::PrimeField::Instantiations::P384 as EC

/**
 * This tests the signature verification vectors for curve P-384 and hashAlg
 * SHA3-384 from [ACVP] "ECDSA-SigGen-FIPS186-5".
 * ```repl
 * :prove testVerification
 * ```
 */
property testVerification = publicKeyWorks && sigVerWorks where
    // Check that the provided `d` computes the expected public key.
    publicKeyWorks = EC::affineEq (ECDSA::publicKey d) (EC::Affine qx qy)

    d = BVtoZ 0x637DEA1FC1D26EEC78BC611912AD185A97BAB54D2BF39B57E53E7D5DFFE5B5C9BD4BC56907CFB298D2655F8F8E46B109
    qx = BVtoZ 0x74384FC31F90F398EFCE861BAB310DC803F0E48CC8C512142A1C606D44A68290A7822CD598A27600A213AAA1E9A5C795
    qy = BVtoZ 0x2F841CFB28045884CF22512029436231776A851CA6E25D3A6349A0727C3AF9A01ED743754DDB91844C3A23E4B635ECF8

    // Check that the given message-signature pairs all verify.
    checkSigVer msg r s = ECDSA::verify msg (r, s) (ECDSA::publicKey d)
    sigVerWorks = and [checkSigVer msg (BVtoZ r) (BVtoZ s) | (msg, r, s) <- [
        (msg321, r321, s321),
        (msg322, r322, s322),
        (msg323, r323, s323),
        (msg324, r324, s324),
        (msg325, r325, s325),
        (msg326, r326, s326),
        (msg327, r327, s327),
        (msg328, r328, s328),
        (msg329, r329, s329),
        (msg330, r330, s330)
    ]]

    // See "internalProjection.json", section "tgId = 33".
    msg321 = 0x0A42E2CB207433A830F382097FD028CE221D62835D35A4EDEB175AC409BFF57EAB23EB9DFDA24474C38E1C9687558A1E5049776D8AECEDF6DFDF6D65E9F7374D8A095F09EF7918998BED6F4A2C84CC587C43BC400C80880B2DDB16153BD06233D9481A54AE06610C8A83ED13F71AD1F6F5A8354B2A1095A45E0E105185A21D79
    r321 = 0x8EDF3F197DE799A51C60D18E5F780D9BE275812B95AAB6D495133545CC28F60A6698197E234926E708E29649171FD846
    s321 = 0xC30FBAC10BA637CBCF0090C0380A87D0AF8955E938A455073A0490C89D203B9DEBB429ED98959D0E94D9B668690BD9D2

    msg322 = 0xE4B3FB70DD79E6581F77C04E7DD4EF564B66456FD2A05657496928CB4CB04123B5328333DC2F03B0980DB6E6E6A6FE4A87326B3238D82E67E7D79FE1297F66D55EA6F57C1F7688B6997D4700083E2EE84A524BB286A0CAAAAEA2AA65E59C2DE00EBF24158F499DD2E4F1D20283DD0A923C857D5760749582BC85C6BC496DA86B
    r322 = 0x34E4F83D0634D54AB8399300320F768C898BAD806472E2BBB97A43D3E192972DFC6B6BC7E749EB0DE758F7B9ABE84AE2
    s322 = 0x558F7B6D641A43ABA14961B4BBF1ED3387CEDC6B63A2BD7592E636BED8569292002BA6947CBA92B0693FD5567F722700

    msg323 = 0xF3A5D47BEEB6CFA91DB494F1D58ED8E5A92D1E2B10A03A8B0FB1967E8FC6CF9FE802B63374BD27D965A4292C3D25E93EFFED4F3CB87D08A9D84939168F354D46E1D216BECCD8D3F86AD6A9184A13D549C726B4DD0DB171FFC0830B48B592AF0FBC7340126EB065B4CA5CED2A7DC82DE491EFA83F450AB921E4856E328C9E5458
    r323 = 0x2A91F9C5594DC00E2210310117433462FAE1007D696224EFF7B1320F9B71B337EB5891AEBF72BC81868BCD1FFA9E11B9
    s323 = 0xC67342700906DDE6E58A09327F86B6BC3EF3C7095E1D0B78E579C745E6A38BD5FB88B03249A0C171E681F47A1759798A

    msg324 = 0x0FCA538DC030A1396D231AF6D6541ECC07B118910F93814BD0E44C13EB01271582DA298B752EAF23A537DC6573F7FE044367D18362890E3955C8BB705446704A888DEED4596134D9347B1A1ECDD7148C55A15A5C4CAFA370AE83ECA908E49EC055AA3C878353A59DC31E3205F9BDBC4272C454F307C5F4C4157127FFFEF8F767
    r324 = 0x81DB1F0A0C214850101E0A36FE187EA6D69163A93D327B5B78E3D27E4B4F9FCF52DCA801560C1D83CA87748AA3A98976
    s324 = 0xC6129FA4937642F4ED941E16E75B39568B42627CA4DEC2ED7E7CDE9BCE97CC75A9F17B66E53B6F6D0F1CDE76961328A0

    msg325 = 0x4674A6DC61490030BBE8CBA60FD04C08575FEF7B0D6300252B94C2931B6F985B567C03C5E31B4FE8EE7B9ED2C8AA8082617278C65143074A3989F7B132EFAB5ABB93518F52AE7ACF2640BE15AD3AAE2346F482C6C954EEA80B56735DEA7629AD904C0D77CDC677E438411A3FEB13A0ADE7E2275B9C3BA6C80A1F56CA92B31140
    r325 = 0xB35E23902EE7DE5DEA8EB6660B5F42F356C0F0201D163A2434E324D6C091FEC09DFD0FEEA19262CC96DC414BB0E693A7
    s325 = 0xCEE4A3F9B00073A923B087AAB97837FBF27531FF9F52E2094D84C34F0D1D166ED1CBDDC519E128E8410E9AA5DECA8A71

    msg326 = 0x494071E57442BF9C651E85E5F4F44A50927472560A46A5ECED7CD87F1B6EBB91086FFD5B52505F91E95C3CCE7F4B4D87CFF0B4FA3B6459479BC436D3D3A8F9A1EC0531417B1940466EAEBB648D40B12350AC27140FA79639B179759397CE3FA4C0C90F306F9E33F704C4A2D19E0BC01057CDA2134CB96BFB35A0DFAF11440B10
    r326 = 0xEB559115C9811607142367DF22E87EF51883BFACC87B2946623986231D29AFF145C9CD11D74DA8FFA9E11A307D8899F4
    s326 = 0xF8195CC37596FF2169F1FDD13FBE5EB62DC5E02A18CD9F83DE7CAA9318AAB6424E9CAF26DC5979EF5387BF6E2B595374

    msg327 = 0x3BC855E9739B04DF9E0735C716493535CCCE2DC3AD6B4299ECE57CDACA58815C6E013873709F5D20D56D8E5D232C03141CD227300E8A7E743CC588D1BCDA4C2C6459F4195D5107F4FE3B4E2BDF7E5E75B638B41785E6B6631B96C577935C5C24986EDC82A1BA4DD1EAAD16C4ED990A013D1C2D19FFE59B41DB96D4AA22F2A114
    r327 = 0xD878B1ECEC9C1495AD8A3515D271ACC134721028D15CA2C09D81F6556C41CC99566F5C9905377CF76BDCC9FFABCB7BFD
    s327 = 0xDBFFAB35BCC89CF3C0D60994EC40376BFE955601EABD0635E6C296E185D62E4A518B414507DFD7E628D337C241FD3BCF

    msg328 = 0x75463363C0D9415887A7B7458B54C1D62546A10766B41BFDEC985A8F221F43F484B5F2253C2C869CD78E87E02DD9302ACC0C7D19C2D04A676C7090467518E60E88E41FBB7F8EE2A25F64D7B11B876D7CDED0A8092DCCD9A37071B31ECEE500AF3FA2689B550FFA7415AAE59C74BBD91F8E5E2B76C726B1F17F75CA7903F74D44
    r328 = 0x46F712F6E4912A84A1DC1979C7C0CE063BDB0AEA330453D77A96C3FDE135040E9DD20CAB2D200BAB8A0BD056E200E261
    s328 = 0xCA0D440005EF9876A43D7C10967128BECD3A87B7EA5AF548C1E8DD4193F335E778B597714C280681D3D35841389841AF

    msg329 = 0x5FBE409F20A658A7FA7D8DBB697742EE0641A851BF22E25BCA38EC90CF85E89BD629ECD9D5AB9FDBC2E64582F043E77D9801B0575EDFA74C97154BBF811A8D40007EFE51F5DBEFB6990730666E797115F86EAB5CC6E81AD47AE2B4C56238E2F34CB4FC6259DFEC445D764079B4212E4CDBADF8640DD9F4FCE15830E11F4D2DD9
    r329 = 0x3043B668763144D44D706B4758CF94C450ABD4D32F2618ADA051939E25B254C70F7FF9805B9ED81A2B154CC5F93C79BA
    s329 = 0x0A97260826386D58BD53CF623CBFC7DAB4EC89CBDA01EEB0266C0FE489871908207019BDCDD5BC2F9254D58918552B27

    msg330 = 0x7D270B5B6D4C962F949287CA87C9FD2854F7C158FA6BD0DBE434B24330F5947A7023A1E789D8F8338F5EE34CE71AFC1D309D87EBEAB8871F0F94346580258D78DE6FE583E62EC5DBE2AC11828AE070189A3268BE6D72E955A788154FB4DADFA0E06D2C57339650995BF45ED40E2FA825E4E9405FC56DE60BC6191A36C821D040
    r330 = 0x081BB00B7735B948A189E72251B1C4B472577D1395819CE99ACF2E4266A1144A653B77D5E516160D241F0FB920273363
    s330 = 0xCC1A45171D1D9E2A7E73436137A8418ED03319E3A7C975CB4209858C2D480327895C5C7FDCC59A735EDFEAE736D6AE8F
